<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Create Map Sample | Longdo Map</title>
    <style type="text/css">
      html {
        height: 100%;
      }
      body {
        margin: 0px;
        height: 100%;
      }
      #map {
        height: 50%;
      }
      #result {
        height: 50%;
      }
    </style>
    <link rel="stylesheet" href="/output.css">
    <script type="module">
      const mapKey = import.meta.env.VITE_LONGDO_MAP_API_KEY;

      const script = document.createElement("script");
      script.type = "text/javascript";
      script.src = `https://api.longdo.com/map3/?key=${mapKey}`;

      script.onload = function () {
        init();
      };

      document.head.appendChild(script);

      var map;

      function init() {
        map = new longdo.Map({
          placeholder: document.getElementById("map"),
        });

        map.Event.bind("ready", function () {
          var marker1 = new longdo.Marker(
            { lon: 100.538316, lat: 13.764953 },
            {
              title: "ตำแหน่งปัจจุบัน",
              detail: "ตำแหน่งของคุณ",
              id: "marker1",
            }
          );

          var marker2 = new longdo.Marker(
            { lon: 100.56, lat: 13.74 },
            {
              title: "จุดเป้าหมาย",
              detail: "จุดที่ต้องการไป",
              id: "marker2",
            }
          );

          drawRoute(marker1.location(), marker2.location());

          map.Event.bind(longdo.EventName.OverlayDrop, function (overlay) {
            console.log(
              "Longitude:",
              overlay.location().lon,
              "Latitude:",
              overlay.location().lat
            );

            setTimeout(() => {
              const distanceSpan = document.querySelector(".ldroute-distance");
              if (distanceSpan) {
                const distanceText = distanceSpan.innerText;
                const distanceValue = parseFloat(distanceText);
                const totalPrice = calculatePrice(distanceValue);
                console.log("ระยะทาง:", distanceValue, "กิโลเมตร");
                console.log("ราคาทั้งหมด:", totalPrice, "บาท");
              } else {
                console.log("ไม่พบระยะทาง");
              }
            }, 500);
            return false;
          });
        });
      }

      function drawRoute(start, end) {
        console.log("Drawing route from", start, "to", end);
        map.Route.clear();
        map.Route.placeholder(document.getElementById("result"));
        map.Route.add(start);
        map.Route.add(end);
        map.Route.search();
      }

      function calculatePrice(distanceValue) {
        const initial_price = 100; // ราคาเริ่มต้น 100 บาท
        const initial_distance = 5; // กิโลเมตรแรกที่คิดราคาคงที่
        const additional_price = 6; // ราคาต่อกิโลเมตรที่เกินจาก initial_distance

        // ตรวจสอบว่าระยะทางเกิน initial_distance หรือไม่
        if (distanceValue <= initial_distance) {
          return initial_price;
        } else {
          const extra_distance = distanceValue - initial_distance;
          const extra_cost = extra_distance * additional_price;
          return initial_price + extra_cost;
        }
      }
    </script>
  </head>
  <body>
    <nav class="bg-white">
      <div class="mx-auto max-w-7xl px-2 sm:px-6 lg:px-8">
        <div class="relative flex h-16 items-center justify-between">
          <div
            class="flex flex-1 items-center justify-center sm:items-stretch sm:justify-start"
          >
            <div class="flex flex-shrink-0 items-center">
              <img src="/img.png" alt="" class="size-14 mr-3" />
              <a href="" class="text-3xl font-bold">CaliCloud</a>
            </div>
            <div class="hidden sm:ml-6 sm:block">
              <div class="flex space-x-4">
                <a href="" class="rounded-md px-3 py-4 text-xl text-gray-400"
                  >Home</a
                >
              </div>
            </div>
            <div class="hidden sm:ml-6 sm:block">
              <div class="flex space-x-4">
                <a href="" class="rounded-md px-3 py-4 text-xl text-gray-400"
                  >Reservation</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <div id="map"></div>
    <div id="result"></div>
  </body>
</html>
